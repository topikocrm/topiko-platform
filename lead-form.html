<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topiko - Complete Business Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="css/styles_css.css">
</head>
<body>
    <!-- Back Button -->
    <div class="back-button hidden" id="backButton" onclick="goBack()">
        ‚Üê
    </div>

    <!-- Error Display -->
    <div class="error-display" id="errorDisplay">
        <div id="errorContent"></div>
    </div>

    <!-- Debug Toggle -->
    <button class="debug-toggle" onclick="toggleDebugPanel()">üîç</button>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <h4>üîç Debug Log</h4>
        <div id="debugLog"></div>
    </div>

    <!-- Lead Score Widget -->
    <div class="lead-score-widget" id="leadWidget" onclick="toggleScoreDetails()">
        <div class="score-circle cold" id="leadScoreCircle">
            <span id="leadScoreValue">0</span>
        </div>
        <div class="score-label" id="scoreLabel">Score</div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div id="notificationContent"></div>
    </div>

    <!-- FOMO Notification System - POSITIONED BOTTOM-LEFT WITH AUTO-HIDE -->
    <div class="fomo-notification" id="fomoNotification" style="position: fixed; bottom: 20px; left: 20px; transform: translateX(-400px); z-index: 999; max-width: 320px; transition: all 0.5s ease;">
        <div class="fomo-header">
            <div class="fomo-icon"></div>
            <div class="fomo-status">New Member</div>
        </div>
        <div class="fomo-content" id="fomoContent">
            <span class="business-name">TrendyWear Collection</span> from <span class="business-location">Pune</span> joined our platform with help of Topiko
        </div>
        <div class="fomo-time" id="fomoTime">5 minutes ago</div>
    </div>

    <!-- FOMO Counter -->
    <div class="fomo-counter" id="fomoCounter">
        <span class="counter-number" id="counterNumber">247</span>
        <span class="counter-text">joined in<br>last 24 hours</span>
    </div>

    <div class="app-container">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-step" data-step="goals" onclick="navigateToStep('goals')">
                    <div class="progress-circle">1</div>
                    <div class="progress-label">Business Goals</div>
                </div>
                <div class="progress-step" data-step="registration" onclick="navigateToStep('registration')">
                    <div class="progress-circle">2</div>
                    <div class="progress-label">Sign Up</div>
                </div>
                <div class="progress-step" data-step="qualifying-questions" onclick="navigateToStep('qualifying-questions')">
                    <div class="progress-circle">3</div>
                    <div class="progress-label">Success Factors</div>
                </div>
                <div class="progress-step" data-step="categories" onclick="navigateToStep('categories')">
                    <div class="progress-circle">4</div>
                    <div class="progress-label">Business Live-1</div>
                </div>
                <div class="progress-step" data-step="products" onclick="navigateToStep('products')">
                    <div class="progress-circle">5</div>
                    <div class="progress-label">Business Live-2</div>
                </div>
                <div class="progress-step" data-step="themes" onclick="navigateToStep('themes')">
                    <div class="progress-circle">6</div>
                    <div class="progress-label">Business Live-3</div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Welcome Screen -->
            <section class="screen active" id="welcome">
                <div class="welcome-screen">
                    <h1 class="topiko-logo">Topiko</h1>
                    <p style="font-size: 1.1rem; color: #6b46c1; margin-bottom: 2rem;">Complete Business Platform for Indian SMBs</p>
                    <button class="try-free-button" onclick="startLeadFlow()">
                        Try for Free
                    </button>
                </div>
            </section>

            <!-- Language Selection Screen -->
            <section class="screen" id="language">
                <div class="content-card">
                    <h2 style="text-align: center; margin-bottom: 0.5rem;">Choose Your Language</h2>
                    <p style="text-align: center; margin-bottom: 2rem; font-size: 0.9rem;">‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç | ‡∞Æ‡±Ä ‡∞≠‡∞æ‡∞∑‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø | ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç</p>
                    
                    <div class="language-grid">
                        <div class="language-option" onclick="selectLanguage('en', this)">
                            <div class="language-flag">üá¨üáß</div>
                            <div class="language-content">
                                <h3>English</h3>
                                <p>Continue in English</p>
                            </div>
                        </div>

                        <div class="language-option" onclick="selectLanguage('hi', this)">
                            <div class="language-flag">üáÆüá≥</div>
                            <div class="language-content">
                                <h3>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</h3>
                                <p>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç</p>
                            </div>
                        </div>

                        <div class="language-option" onclick="selectLanguage('te', this)">
                            <div class="language-flag">üáÆüá≥</div>
                            <div class="language-content">
                                <h3>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</h3>
                                <p>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å‡∞≤‡±ã ‡∞ï‡±ä‡∞®‡∞∏‡∞æ‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</p>
                            </div>
                        </div>

                        <div class="language-option" onclick="selectLanguage('ta', this)">
                            <div class="language-flag">üáÆüá≥</div>
                            <div class="language-content">
                                <h3>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</h3>
                                <p>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Æø‡Æ≤‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Goals Selection Screen -->
            <section class="screen" id="goals">
                <div class="content-card">
                    <h2 style="text-align: center; margin-bottom: 0.5rem;">Select Your Goals</h2>
                    <p style="text-align: center; margin-bottom: 2rem;">Choose what you want to achieve with Topiko (select all that apply)</p>
                    
                    <div class="goals-grid">
                        <div class="goal-option">
                            <input type="checkbox" id="goal-ecommerce" value="ecommerce" class="goal-checkbox" onchange="updateGoalsTracking()">
                            <label for="goal-ecommerce" class="goal-card">
                                <div class="goal-icon">üõí</div>
                                <div class="goal-content">
                                    <h3>Sell Online (E-commerce)</h3>
                                    <p>Start selling your products online with a complete e-commerce solution</p>
                                </div>
                                <div class="goal-checkmark">‚úì</div>
                            </label>
                        </div>

                        <div class="goal-option">
                            <input type="checkbox" id="goal-customers" value="customers" class="goal-checkbox" onchange="updateGoalsTracking()">
                            <label for="goal-customers" class="goal-card">
                                <div class="goal-icon">üìà</div>
                                <div class="goal-content">
                                    <h3>Reach More Customers</h3>
                                    <p>Expand your customer base and grow your market reach</p>
                                </div>
                                <div class="goal-checkmark">‚úì</div>
                            </label>
                        </div>

                        <div class="goal-option">
                            <input type="checkbox" id="goal-manage" value="manage" class="goal-checkbox" onchange="updateGoalsTracking()">
                            <label for="goal-manage" class="goal-card">
                                <div class="goal-icon">üë•</div>
                                <div class="goal-content">
                                    <h3>Manage Customers</h3>
                                    <p>Keep track of your customers and build lasting relationships</p>
                                </div>
                                <div class="goal-checkmark">‚úì</div>
                            </label>
                        </div>

                        <div class="goal-option">
                            <input type="checkbox" id="goal-search" value="search" class="goal-checkbox" onchange="updateGoalsTracking()">
                            <label for="goal-search" class="goal-card">
                                <div class="goal-icon">üîç</div>
                                <div class="goal-content">
                                    <h3>Appear in Search Results</h3>
                                    <p>Improve your online visibility and get found by potential customers</p>
                                </div>
                                <div class="goal-checkmark">‚úì</div>
                            </label>
                        </div>

                        <div class="goal-option">
                            <input type="checkbox" id="goal-brand" value="brand" class="goal-checkbox" onchange="updateGoalsTracking()">
                            <label for="goal-brand" class="goal-card">
                                <div class="goal-icon">‚≠ê</div>
                                <div class="goal-content">
                                    <h3>Establish my Brand</h3>
                                    <p>Build a strong brand presence and professional image online</p>
                                </div>
                                <div class="goal-checkmark">‚úì</div>
                            </label>
                        </div>
                    </div>

                    <button class="submit-button" onclick="showGoalsTransitionModal()">
                        Next Step
                    </button>
                </div>
            </section>

            <!-- Registration Screen -->
            <section class="screen" id="registration">
                <div class="content-card">
                    <h2 style="text-align: center; margin-bottom: 0.5rem;">Get Started with Topiko</h2>
                    <p style="text-align: center; margin-bottom: 2rem;">Tell us about your business to create your free account</p>
                    
                    <div class="form-group">
                        <label for="fullName">Your Name</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" oninput="trackFormProgress()">
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email address" oninput="trackFormProgress()">
                    </div>

                    <div class="form-group">
                        <label for="phoneNumber">Phone Number</label>
                        <input type="tel" id="phoneNumber" placeholder="Enter your phone number" oninput="trackFormProgress()">
                    </div>

                    <div class="form-group">
                        <label for="businessName">Business Name</label>
                        <input type="text" id="businessName" placeholder="Enter your business name" oninput="trackFormProgress()">
                    </div>

                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea id="address" rows="3" placeholder="Enter your business address" oninput="trackFormProgress()"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="businessType">Business Type</label>
                        <select id="businessType" onchange="trackFormProgress()">
                            <option value="">Select your business type</option>
                            <option value="startup">Startup</option>
                            <option value="small-business">Small Business</option>
                            <option value="medium-enterprise">Medium Enterprise</option>
                            <option value="large-enterprise">Large Enterprise</option>
                            <option value="freelancer">Freelancer</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="category">Business Category</label>
                        <select id="category" onchange="trackFormProgress()">
                            <option value="">Select your business category</option>
                            <option value="boutique">üè™ Boutique & Fashion</option>
                            <option value="home-foods">üçõ Home Foods & Catering</option>
                            <option value="salons">üíÑ Salons & Beauty</option>
                            <option value="grocery">üõí Grocery & Provisions</option>
                            <option value="furniture">üõãÔ∏è Furniture & Home Decor</option>
                            <option value="electronics">üì± Electronics & Gadgets</option>
                            <option value="jewellery">üíç Jewellery & Accessories</option>
                            <option value="restaurants">üçΩÔ∏è Restaurants & Cafes</option>
                            <option value="fitness">üí™ Fitness & Wellness</option>
                            <option value="education">üìö Education & Training</option>
                            <option value="automotive">üöó Automotive Services</option>
                            <option value="healthcare">üè• Healthcare Services</option>
                            <option value="professional">üíº Professional Services</option>
                            <option value="arts-crafts">üé® Arts & Crafts</option>
                            <option value="travel">‚úàÔ∏è Travel & Tourism</option>
                            <option value="pet-services">üêæ Pet Services & Supplies</option>
                            <option value="real-estate">üè† Real Estate Services</option>
                            <option value="event-services">üéâ Event & Wedding Services</option>
                            <option value="agriculture">üåæ Agriculture & Farming</option>
                            <option value="others">üîß Others</option>
                        </select>
                    </div>

                    <button class="submit-button" onclick="submitRegistration()">
                        Show my Business online
                    </button>
                </div>
            </section>

            <!-- Qualifying Questions Screen -->
            <section class="screen" id="qualifying-questions">
                <div class="content-card">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: #6b46c1; font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem;" id="qualifyingTitle">
                            Let's setup things for you
                        </h2>
                        <p style="color: #553c9a; font-size: 1rem; font-weight: 500;">
                            Just need a couple of details about your business
                        </p>
                    </div>

                    <!-- Question 1: Online Presence -->
                    <div class="qualifying-question">
                        <h3>Do you currently have any online presence?</h3>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" id="presence-none" name="online_presence" value="none" class="radio-input" onchange="updateQualifyingData()">
                                <label for="presence-none" class="radio-card">
                                    <div class="radio-icon"></div>
                                    No online presence at all
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="presence-whatsapp" name="online_presence" value="whatsapp" class="radio-input" onchange="updateQualifyingData()">
                                <label for="presence-whatsapp" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Only WhatsApp Business
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="presence-social" name="online_presence" value="social" class="radio-input" onchange="updateQualifyingData()">
                                <label for="presence-social" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Social media pages (Facebook/Instagram)
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="presence-basic" name="online_presence" value="basic_website" class="radio-input" onchange="updateQualifyingData()">
                                <label for="presence-basic" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Basic website
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="presence-full" name="online_presence" value="full_website" class="radio-input" onchange="updateQualifyingData()">
                                <label for="presence-full" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Full website with online ordering
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Question 2: Budget -->
                    <div class="qualifying-question">
                        <h3>To meet your business goals, how much budget can you allocate per year?</h3>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" id="budget-low" name="budget" value="5000-10000" class="radio-input" onchange="updateQualifyingData()">
                                <label for="budget-low" class="radio-card">
                                    <div class="radio-icon"></div>
                                    ‚Çπ5,000 to ‚Çπ10,000
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="budget-medium" name="budget" value="10000-25000" class="radio-input" onchange="updateQualifyingData()">
                                <label for="budget-medium" class="radio-card">
                                    <div class="radio-icon"></div>
                                    ‚Çπ10,000 to ‚Çπ25,000
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="budget-high" name="budget" value="25000+" class="radio-input" onchange="updateQualifyingData()">
                                <label for="budget-high" class="radio-card">
                                    <div class="radio-icon"></div>
                                    More than ‚Çπ25,000
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Question 3: Decision Maker -->
                    <div class="qualifying-question">
                        <h3>Are you the decision maker for your business?</h3>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" id="decision-yes" name="decision_maker" value="yes" class="radio-input" onchange="updateQualifyingData()">
                                <label for="decision-yes" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Yes
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="decision-no" name="decision_maker" value="no" class="radio-input" onchange="updateQualifyingData()">
                                <label for="decision-no" class="radio-card">
                                    <div class="radio-icon"></div>
                                    No
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Question 4: Timeline -->
                    <div class="qualifying-question">
                        <h3>How soon do you want to get started?</h3>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" id="timeline-immediate" name="timeline" value="immediately" class="radio-input" onchange="updateQualifyingData()">
                                <label for="timeline-immediate" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Immediately
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="timeline-week" name="timeline" value="within_week" class="radio-input" onchange="updateQualifyingData()">
                                <label for="timeline-week" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Within a week
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="timeline-month" name="timeline" value="this_month" class="radio-input" onchange="updateQualifyingData()">
                                <label for="timeline-month" class="radio-card">
                                    <div class="radio-icon"></div>
                                    This month
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="timeline-checking" name="timeline" value="just_checking" class="radio-input" onchange="updateQualifyingData()">
                                <label for="timeline-checking" class="radio-card">
                                    <div class="radio-icon"></div>
                                    Just checking
                                </label>
                            </div>
                        </div>
                    </div>

                    <button class="submit-button" onclick="proceedToCategories()" id="qualifyingNextBtn" disabled style="opacity: 0.5;">
                        Create my Business üöÄ
                    </button>
                </div>
            </section>

            <!-- Categories Screen -->
            <section class="screen" id="categories">
                <div class="content-card">
                    <h2 style="text-align: center; margin-bottom: 0.5rem;" id="categoriesTitle">Select Your Business Categories</h2>
                    <p style="text-align: center; margin-bottom: 2rem;">Choose specific categories and subcategories that best describe your business</p>
                    
                    <!-- Selection Summary -->
                    <div class="selection-summary" id="selectionSummary" style="display: none;">
                        <div style="display: flex; gap: 2rem; align-items: flex-start;">
                            <div style="flex: 1;">
                                <div class="summary-title">üìä Your Selection Summary</div>
                                <div class="summary-content">
                                    <div class="summary-item">
                                        <span>Categories: </span>
                                        <span class="summary-count" id="categoriesCount">0</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Subcategories: </span>
                                        <span class="summary-count" id="subcategoriesCount">0</span>
                                    </div>
                                </div>
                            </div>
                            <!-- MOVED: Dynamic Motivational Messages -->
                            <div class="motivational-messages" id="motivationalMessages" style="min-width: 280px; max-width: 300px; height: 120px; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 2px solid #10b981; border-radius: 12px; padding: 1rem; position: relative; overflow: hidden;">
                                <div class="motivational-message active loading">
                                    üîÑ Loading personalized messages for Perfect...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="categoriesContainer">
                        <!-- Categories will be populated dynamically -->
                    </div>

                    <button class="submit-button" onclick="proceedToProducts()" id="categoryNextBtn" disabled>
                        Continue to Add Products
                    </button>
                </div>
            </section>

            <!-- Products Screen - UPDATED WITH PRODUCT SELECTOR -->
            <section class="screen" id="products">
                <div class="content-card">
                    <h2 style="text-align: center; margin-bottom: 0.5rem;" id="productsTitle">Add Your Products</h2>
                    <p style="text-align: center; margin-bottom: 2rem;">Choose products or add your own custom products</p>
                    
                    <!-- Help Section - KEEP UNCHANGED -->
                    <div class="products-help-section" id="productsHelpSection" onclick="requestFollowup()">
                        <div class="help-title" id="productsHelpTitle">üéØ Free Professional Setup Available!</div>
                        <div class="help-progress">
                            <div class="help-progress-fill" id="productsHelpProgressFill"></div>
                        </div>
                        <div class="help-text" id="productsHelpText">
                            Topiko is helping with free setup for 75 businesses every month. <span id="productsClaimedCount">47</span> claimed for <span id="productsCurrentMonth">January</span>. Click here for help!
                        </div>
                    </div>

                    <!-- NEW: Product Selection Mode Toggle -->
                    <div class="product-mode-toggle">
                        <div class="toggle-options">
                            <button class="toggle-option active" id="selectMode" onclick="switchProductMode('select')">
                                <span class="toggle-icon">üõçÔ∏è</span>
                                Select Products
                            </button>
                            <button class="toggle-option" id="customMode" onclick="switchProductMode('custom')">
                                <span class="toggle-icon">‚ûï</span>
                                Add Custom Product
                            </button>
                        </div>
                    </div>

                    <!-- NEW: Product Selector Section -->
                    <div class="product-selector-section" id="productSelectorSection">
                        
                        <!-- Helper Buttons -->
                        <div class="product-helpers">
                            <button onclick="selectPopularProducts()" class="helper-btn">
                                ‚ú® Select Popular Items
                            </button>
                            <button onclick="clearAllSelections()" class="helper-btn secondary">
                                üóëÔ∏è Clear All
                            </button>
                        </div>
                        
                        <!-- FIXED: Quick Filters with proper container structure -->
                        <div class="quick-filters-container" id="quickFiltersContainer">
                            <div class="quick-filters" id="quickFilters">
                                <button class="quick-filter active" data-category="all" onclick="applyQuickFilter('all', this)">All Products</button>
                                <button class="quick-filter" data-category="boutique" onclick="applyQuickFilter('boutique', this)">Fashion</button>
                                <button class="quick-filter" data-category="homefoods" onclick="applyQuickFilter('homefoods', this)">Home Foods</button>
                                <button class="quick-filter" data-category="grocery" onclick="applyQuickFilter('grocery', this)">Grocery</button>
                                <button class="quick-filter" data-category="electronics" onclick="applyQuickFilter('electronics', this)">Electronics</button>
                                <button class="quick-filter" data-category="fitness" onclick="applyQuickFilter('fitness', this)">Fitness</button>
                                <button class="quick-filter" data-category="restaurant" onclick="applyQuickFilter('restaurant', this)">Restaurant</button>
                            </div>
                        </div>
                        
                        <!-- Search & Filter Controls -->
                        <div class="product-controls">
                            <div class="search-box">
                                <input type="text" id="productSearch" placeholder="Search products..." />
                                <span class="search-icon">üîç</span>
                            </div>
                            
                            <select id="categoryFilter" class="filter-select">
                                <option value="all">All Categories</option>
                                <option value="boutique">Boutique & Fashion</option>
                                <option value="homefoods">Home Foods</option>
                                <option value="grocery">Grocery & Provisions</option>
                                <option value="electronics">Electronics & Gadgets</option>
                                <option value="fitness">Fitness & Wellness</option>
                                <option value="restaurant">Restaurant & Food</option>
                            </select>
                            
                            <select id="sortBy" class="sort-select">
                                <option value="name">Sort by Name</option>
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                                <option value="category">Category</option>
                            </select>
                            
                            <div class="products-count">
                                <span id="productsCount">500</span> products
                            </div>
                        </div>

                        <!-- Price Range -->
                        <div class="price-range">
                            <label>Price Range: ‚Çπ<span id="priceRangeDisplay">0 - ‚Çπ5000</span></label>
                            <div class="price-inputs">
                                <input type="number" id="minPrice" placeholder="Min" value="0" min="0" max="5000">
                                <span>to</span>
                                <input type="number" id="maxPrice" placeholder="Max" value="5000" min="0" max="5000">
                            </div>
                        </div>
                        
                        <!-- Products Grid -->
                        <div class="products-grid" id="productsGrid">
                            <div class="loading">Loading products...</div>
                        </div>
                    </div>

                    <!-- EXISTING: Custom Product Form (Modified to be toggleable) -->
                    <div class="product-form" id="customProductForm" style="display: none;">
                        <h3 style="color: #6b46c1; margin-bottom: 1rem; font-size: 1.1rem;" id="productFormTitle">Add Custom Product/Service</h3>
                        
                        <div class="form-group">
                            <label for="productName">Product/Service Name</label>
                            <input type="text" id="productName" placeholder="e.g., Cotton Kurta, Masala Dosa, Haircut">
                        </div>
                        
                        <div class="form-group">
                            <label for="productPrice">Price (‚Çπ)</label>
                            <input type="number" id="productPrice" placeholder="e.g., 899">
                        </div>

                        <div class="form-group">
                            <label for="productCategory">Category</label>
                            <select id="productCategory">
                                <option value="">Select from your chosen categories</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="productSubcategory">Subcategory (Optional)</label>
                            <select id="productSubcategory">
                                <option value="">Select a subcategory</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" rows="3" placeholder="Brief description of your product or service"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="productImage">Product Image URL (optional)</label>
                            <input type="url" id="productImage" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <button type="button" onclick="addCustomProduct()" class="btn-secondary" style="width: auto; margin-top: 1rem;">
                            ‚ûï Add Custom Product
                        </button>
                    </div>

                    <!-- NEW: Selected Products Summary -->
                    <div class="selected-products-summary" id="selectedProductsSection" style="display: none;">
                        <h3 style="color: #6b46c1; margin-bottom: 1rem; font-size: 1.1rem;">
                            <span style="margin-right: 0.5rem;">üéØ</span>
                            Selected Products (<span id="selectedCount">0</span>)
                        </h3>
                        <div id="selectedProductsList"></div>
                    </div>

                    <!-- MODIFIED: Products List (now shows all selected products) -->
                    <div class="products-list">
                        <h3 style="color: #6b46c1; margin-bottom: 1rem; font-size: 1.1rem;">Your Product Catalog (<span id="productCount">0</span>)</h3>
                        
                        <div class="product-grid" id="productsList">
                            <div style="text-align: center; padding: 2rem; color: #64748b; background: rgba(255, 255, 255, 0.5); border-radius: 12px;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üì¶</div>
                                <p>No products selected yet. Choose products above or add custom products!</p>
                            </div>
                        </div>
                    </div>

                    <!-- KEEP: Navigation buttons unchanged -->
                    <div class="flex-buttons">
                        <button onclick="navigateToStep('categories')" class="btn-secondary">
                            ‚Üê Back to Categories
                        </button>
                        <button onclick="proceedToThemes()" class="submit-button">
                            Choose Theme üé®
                        </button>
                    </div>
                </div>
            </section>

            <!-- Theme Selection Screen -->
            <section class="screen" id="themes">
                <div class="content-card">
                    <h2 style="text-align: center; margin-bottom: 0.5rem;" id="themesTitle">Choose Your Business Theme</h2>
                    <p style="text-align: center; margin-bottom: 2rem;">Select a theme that represents your business style. See how your products will look!</p>
                    
                    <div class="theme-grid">
                        <!-- Modern & Minimalist Theme -->
                        <div class="theme-option" onclick="selectTheme('modern', this)">
                            <div class="theme-header">
                                <h3>
                                    <span style="margin-right: 0.5rem;">‚ú®</span>
                                    Modern & Minimalist
                                </h3>
                                <p>Clean, simple design that focuses on your products</p>
                            </div>
                            <div class="theme-preview" id="modern-preview">
                                <!-- Products preview will be populated here -->
                            </div>
                        </div>

                        <!-- Colorful & Vibrant Theme -->
                        <div class="theme-option" onclick="selectTheme('vibrant', this)">
                            <div class="theme-header">
                                <h3>
                                    <span style="margin-right: 0.5rem;">üåà</span>
                                    Colorful & Vibrant
                                </h3>
                                <p>Bold colors and energetic design to attract customers</p>
                            </div>
                            <div class="theme-preview" style="background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #fecaca 100%);" id="vibrant-preview">
                                <!-- Products preview will be populated here -->
                            </div>
                        </div>

                        <!-- Professional & Corporate Theme -->
                        <div class="theme-option" onclick="selectTheme('professional', this)">
                            <div class="theme-header">
                                <h3>
                                    <span style="margin-right: 0.5rem;">üíº</span>
                                    Professional & Corporate
                                </h3>
                                <p>Sophisticated design that builds trust and credibility</p>
                            </div>
                            <div class="theme-preview" style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white;" id="professional-preview">
                                <!-- Products preview will be populated here -->
                            </div>
                        </div>

                        <!-- Traditional & Classic Theme -->
                        <div class="theme-option" onclick="selectTheme('traditional', this)">
                            <div class="theme-header">
                                <h3>
                                    <span style="margin-right: 0.5rem;">üèõÔ∏è</span>
                                    Traditional & Classic
                                </h3>
                                <p>Timeless design with warm, welcoming feel</p>
                            </div>
                            <div class="theme-preview" style="background: linear-gradient(135deg, #fef7cd 0%, #fde68a 100%);" id="traditional-preview">
                                <!-- Products preview will be populated here -->
                            </div>
                        </div>

                        <!-- Creative & Artistic Theme -->
                        <div class="theme-option" onclick="selectTheme('creative', this)">
                            <div class="theme-header">
                                <h3>
                                    <span style="margin-right: 0.5rem;">üé®</span>
                                    Creative & Artistic
                                </h3>
                                <p>Unique, artistic design that showcases creativity</p>
                            </div>
                            <div class="theme-preview" style="background: linear-gradient(135deg, #ddd6fe 0%, #c7d2fe 50%, #bfdbfe 100%);" id="creative-preview">
                                <!-- Products preview will be populated here -->
                            </div>
                        </div>

                        <!-- Elegant & Luxury Theme -->
                        <div class="theme-option" onclick="selectTheme('luxury', this)">
                            <div class="theme-header">
                                <h3>
                                    <span style="margin-right: 0.5rem;">üíé</span>
                                    Elegant & Luxury
                                </h3>
                                <p>Premium design for high-end products and services</p>
                            </div>
                            <div class="theme-preview" style="background: linear-gradient(135deg, #1c1917 0%, #292524 100%); color: #d6d3d1;" id="luxury-preview">
                                <!-- Products preview will be populated here -->
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 1.5rem 0;">
                        <p style="color: #6b7280; font-size: 0.8rem; margin-bottom: 1rem;">
                            <span id="selectedThemeName">No theme selected</span> | You can change this anytime later
                        </p>
                    </div>

                    <div class="flex-buttons">
                        <button onclick="navigateToStep('products')" class="btn-secondary">
                            ‚Üê Back to Products
                        </button>
                        <button onclick="completeSetup()" id="themeNextBtn" disabled style="opacity: 0.5;">
                            Complete Setup üöÄ
                        </button>
                    </div>
                </div>
            </section>

            <!-- COMPLETION SCREEN - ENHANCED -->
           <!-- COMPLETION SCREEN - ENHANCED WITH SPECIAL OFFERS -->
<section class="screen" id="completion">
    <div class="content-card">
        <div style="text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem; animation: bounce 2s infinite;">üéâ</div>
            
            <h2 style="color: #059669; font-size: 2.2rem; font-weight: 700; margin-bottom: 1rem;">
                Congratulations, <span id="completionBusinessName">Your Business</span> is all set for the final touches!
            </h2>
            
            <p style="color: #064e3b; font-size: 1.1rem; margin-bottom: 2rem; line-height: 1.6;">
                Your business setup is complete! Our team will now create your professional online presence.
            </p>

            <!-- TODAY'S SPECIAL OFFERS SECTION -->
            <div class="offers-section-background">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 2rem; margin-right: 0.5rem;">üéÅ</div>
                    <h3 style="color: #d97706; font-size: 1.4rem; margin: 0; font-weight: 700;">Today's Exclusive Offers for You!</h3>
                </div>
                
                <!-- Random Offers Container -->
                <div id="specialOffersContainer">
                    <!-- Offers will be populated here by JavaScript -->
                    <div class="special-offer-item">
                        <div class="offer-title">
                            üéÅ Loading Special Offers...
                            <span class="offer-value">FREE</span>
                        </div>
                        <div class="offer-description">Preparing personalized offers for your business</div>
                    </div>
                </div>
                
                <div style="background: rgba(34, 197, 94, 0.1); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 1rem; margin: 1rem 0; color: #059669; font-weight: 600; font-size: 0.9rem; text-align: center;">
                    üî• Limited Time: These offers expire in <span id="offerTimer" style="color: #dc2626; font-weight: 700;">23:45:12</span>
                </div>
            </div>

            <!-- CHOICE SELECTION -->
            <div style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border: 2px solid #6366f1; border-radius: 16px; padding: 2rem; margin: 2rem 0;">
                <h3 style="color: #4338ca; font-size: 1.3rem; margin-bottom: 1rem;">üéØ Choose Your Next Step:</h3>
                
                <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="offer-option" onclick="selectOffer('talk_team', this)">
                        <label style="cursor: pointer; display: block; padding: 1rem; background: rgba(255, 255, 255, 0.9); border: 2px solid rgba(99, 102, 241, 0.2); border-radius: 12px; font-weight: 600; color: #4338ca; text-align: center;">
                            <input type="radio" name="completion_offer" value="talk_team" style="display: none;">
                            üìû I want to talk to Topiko Team & Claim Offers!
                        </label>
                    </div>
                    
                    <div class="offer-option" onclick="selectOffer('self_explore', this)">
                        <label style="cursor: pointer; display: block; padding: 1rem; background: rgba(255, 255, 255, 0.9); border: 2px solid rgba(99, 102, 241, 0.2); border-radius: 12px; font-weight: 600; color: #4338ca; text-align: center;">
                            <input type="radio" name="completion_offer" value="self_explore" style="display: none;">
                            üöÄ I want to explore by myself (Skip Offers)
                        </label>
                    </div>
                </div>

                <button onclick="handleCompletionChoice()" id="completionChoiceBtn" disabled 
                        style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; padding: 1rem 2rem; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; opacity: 0.5; width: 100%;">
                    Continue
                </button>
            </div>
        </div>
    </div>
</section>
        </main>
    </div>

    <!-- UPDATED Modal HTML Structures -->
    
    <!-- Goals Transition Modal - UPDATED -->
    <div class="modal-overlay" id="goalsTransitionModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('goalsTransitionModal')">√ó</button>
            
            <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem; animation: bounce 2s infinite;">üéØ</div>
                
                <h2 style="color: #6b46c1; font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.3;">
                    Great! Your goals are set.
                </h2>
                
                <p style="color: #553c9a; font-size: 1rem; font-weight: 500; margin-bottom: 1.5rem; line-height: 1.6;">
                    Now let's show you how Topiko can help with 
                    <span id="selectedGoalsInlineText" style="display: block; margin: 0.5rem 0; color: #6b46c1; font-weight: 600;">your selected goals</span> 
                    for your business ‚Äî one step at a time
                </p>

                <!-- UPDATED: Benefits on separate lines -->
                    <div style="background: rgba(34, 197, 94, 0.1); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 1rem; margin: 1rem 0; color: #059669; font-weight: 600; font-size: 0.9rem; text-align: left; line-height: 1.8;">
                        Topiko helped 5,500+ businesses reach their goals last month ‚Äî let's do the same for yours! 
                        
                        <div style="margin-top: 0.8rem; display: flex; flex-direction: column; gap: 0.3rem;">
                            <div style="display: flex; align-items: center;">
                                <span style="margin-right: 0.5rem;">‚ú®</span>
                                <span>No technical knowledge needed</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span style="margin-right: 0.5rem;">‚úÖ</span>
                                <span>ZERO obligation to continue</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span style="margin-right: 0.5rem;">üß™</span>
                                <span>Try before you decide</span>
                            </div>
                        </div>
                    </div>

                <button class="submit-button" onclick="proceedFromGoalsModal()" style="animation: pulse 2s infinite; margin-top: 1rem;">
                    Get My Free Setup! üöÄ
                </button>
            </div>
        </div>
    </div>

    <!-- Setup Intro Modal - UPDATED (removed goals) -->
    <div class="modal-overlay" id="setupIntroModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('setupIntroModal')">√ó</button>
            
            <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚ú®</div>
                
                <h2 style="color: #059669; font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem;">
                    Excellent, <span id="setupUserName">there</span>! üéâ
                </h2>
                
                <div style="background: rgba(34, 197, 94, 0.1); border: 2px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
                    <p style="color: #059669; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">
                        In just 3 simple steps, we'll show you exactly how your <span id="setupBusinessName">business</span> can look and work online ‚Äî the Topiko way!
                    </p>
                    <p style="color: #064e3b; font-size: 0.95rem; margin-bottom: 0;">
                        üî• Businesses like yours are going live every hour ‚Äî don't miss the momentum!
                    </p>
                </div>

                <button class="submit-button" onclick="proceedFromSetupModal()" style="animation: pulse 2s infinite; font-size: 1.1rem;">
                    Let's Create Something Amazing! üéØ
                </button>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div class="modal-overlay" id="otpVerificationModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('otpVerificationModal')">√ó</button>
            
            <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
                
                <h2 style="color: #6b46c1; font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem;">
                    Verify Your Phone Number
                </h2>
                
                <p style="color: #553c9a; font-size: 1rem; margin-bottom: 1.5rem;">
                    We've sent a 4-digit code to your phone. Enter it below to secure your account.
                </p>

                <div class="otp-input-group">
                    <input type="text" class="otp-input" maxlength="1" oninput="handleOtpInput(this, 0)" onkeyup="if(event.key==='Backspace' && !this.value && this.previousElementSibling) this.previousElementSibling.focus()">
                    <input type="text" class="otp-input" maxlength="1" oninput="handleOtpInput(this, 1)" onkeyup="if(event.key==='Backspace' && !this.value && this.previousElementSibling) this.previousElementSibling.focus()">
                    <input type="text" class="otp-input" maxlength="1" oninput="handleOtpInput(this, 2)" onkeyup="if(event.key==='Backspace' && !this.value && this.previousElementSibling) this.previousElementSibling.focus()">
                    <input type="text" class="otp-input" maxlength="1" oninput="handleOtpInput(this, 3)" onkeyup="if(event.key==='Backspace' && !this.value && this.previousElementSibling) this.previousElementSibling.focus()">
                </div>

                <p style="color: #6b7280; font-size: 0.8rem; margin-bottom: 1.5rem;">
                    Didn't receive the code? <a href="#" style="color: #6b46c1; text-decoration: none;" onclick="showNotification('Code resent!', 'info')">Resend OTP</a>
                </p>

                <button class="submit-button" id="verifyOtpBtn" onclick="verifyOtp()" disabled style="opacity: 0.5;">
                    Verify & Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Date Time Selection Modal -->
    <div class="modal-overlay" id="dateTimeModal">
        <div class="modal-content">
            <h3 style="color: #6b46c1; margin-bottom: 1rem;">üìÖ Schedule Your Call</h3>
            <p style="margin-bottom: 1.5rem;">Select a convenient date and time for our team to contact you:</p>
            
            <div class="time-slots-grid" id="timeSlotsGrid">
                <!-- Today -->
                <div class="time-slot" onclick="selectTimeSlot(this, 'today-10am')">
                    <div class="slot-date">Today</div>
                    <div class="slot-time">10:00 AM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this, 'today-2pm')">
                    <div class="slot-date">Today</div>
                    <div class="slot-time">2:00 PM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this, 'today-4pm')">
                    <div class="slot-date">Today</div>
                    <div class="slot-time">4:00 PM</div>
                </div>
                
                <!-- Tomorrow -->
                <div class="time-slot" onclick="selectTimeSlot(this, 'tomorrow-9am')">
                    <div class="slot-date">Tomorrow</div>
                    <div class="slot-time">9:00 AM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this, 'tomorrow-11am')">
                    <div class="slot-date">Tomorrow</div>
                    <div class="slot-time">11:00 AM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this, 'tomorrow-3pm')">
                    <div class="slot-date">Tomorrow</div>
                    <div class="slot-time">3:00 PM</div>
                </div>
                
                <!-- Day After Tomorrow -->
                <div class="time-slot" onclick="selectTimeSlot(this, 'dayafter-10am')">
                    <div class="slot-date">Day After</div>
                    <div class="slot-time">10:00 AM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this, 'dayafter-1pm')">
                    <div class="slot-date">Day After</div>
                    <div class="slot-time">1:00 PM</div>
                </div>
            </div>
            
            <div style="margin-top: 1.5rem; text-align: center;">
                <button onclick="confirmSchedule()" id="confirmScheduleBtn" disabled 
                        style="background: #6b46c1; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; opacity: 0.5;">
                    Confirm Schedule
                </button>
                <button onclick="closeModal('dateTimeModal')" 
                        style="background: #64748b; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; margin-left: 1rem;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Reason Selection Modal -->
    <div class="modal-overlay" id="reasonModal">
        <div class="modal-content">
            <h3 style="color: #6b46c1; margin-bottom: 1rem;">üí≠ Tell us more</h3>
            <p style="margin-bottom: 1.5rem;">Help us understand your needs better:</p>
            
            <div class="reason-options">
                <div class="reason-option" onclick="selectReason('budget', this)">
                    <div class="reason-icon">üí∞</div>
                    <div class="reason-text">Budget Issue</div>
                </div>
                <div class="reason-option" onclick="selectReason('looking_else', this)">
                    <div class="reason-icon">üîç</div>
                    <div class="reason-text">Looking for something else</div>
                </div>
                <div class="reason-option" onclick="selectReason('need_time', this)">
                    <div class="reason-icon">‚è∞</div>
                    <div class="reason-text">Need time to decide</div>
                </div>
            </div>
            
            <!-- Comment section for "Looking for something else" -->
            <div id="lookingElseComments" style="display: none; margin-top: 1rem; background: #fdf2f8; border-radius: 8px; padding: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 500;">What are you looking for?</label>
                <textarea id="lookingElseText" rows="3" 
                          style="width: 100%; padding: 0.75rem; border: 2px solid #f3e8ff; border-radius: 8px; resize: vertical; font-family: inherit;"
                          placeholder="Please tell us what you're looking for..."></textarea>
            </div>
            
            <div id="reasonComments" style="display: none; margin-top: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 500;">Please elaborate:</label>
                <textarea id="reasonText" rows="3" 
                          style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; resize: vertical; font-family: inherit;"
                          placeholder="Your comments..."></textarea>
            </div>
            
            <div style="margin-top: 1.5rem; text-align: center;">
                <button onclick="submitReason()" id="submitReasonBtn" disabled 
                        style="background: #6b46c1; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; opacity: 0.5;">
                    Submit
                </button>
            </div>
        </div>
    </div>

    <!-- FIXED: Script Loading Order - CRITICAL -->
    <script src="js/config_js.js"></script>     <!-- FIRST - Configuration -->
    <script src="js/utils_js.js"></script>      <!-- SECOND - Utilities -->  
    <script src="js/script_js.js"></script>     <!-- THIRD - Main Application -->

    <!-- Additional Initialization and Compatibility Script -->
    <script>
    // Additional initialization and safety checks
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîß Running HTML compatibility fixes...');
        
        // Fix 1: Ensure quick filters container exists (already fixed in HTML above)
        const quickFilters = document.getElementById('quickFilters');
        if (quickFilters && !quickFilters.parentElement.classList.contains('quick-filters-container')) {
            console.log('‚ö†Ô∏è Quick filters container was missing, but should be fixed now');
        } else {
            console.log('‚úÖ Quick filters container structure is correct');
        }
        
        // Fix 2: Ensure completion screen business name is populated
        setTimeout(() => {
            const completionBusinessName = document.getElementById('completionBusinessName');
            if (completionBusinessName && window.topikoApp && window.topikoApp.businessName) {
                completionBusinessName.textContent = window.topikoApp.businessName;
            }
        }, 1000);
        
        // Fix 3: Initialize product mode correctly
        setTimeout(() => {
            if (typeof switchProductMode === 'function') {
                try {
                    switchProductMode('select');
                    console.log('‚úÖ Product mode initialized');
                } catch (error) {
                    console.warn('‚ö†Ô∏è Product mode initialization failed:', error);
                }
            }
        }, 2000);
        
        console.log('‚úÖ HTML compatibility fixes completed');
    });

    // Global function to close modals (needed for the new modals)
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('show');
            setTimeout(() => {
                if (modal.parentNode === document.body) {
                    document.body.removeChild(modal);
                }
            }, 300);
        }
    }

    // Update lead score widget to ensure text displays
    function updateLeadScoreWidget() {
        const scoreValue = document.getElementById('leadScoreValue');
        const scoreLabel = document.getElementById('scoreLabel');
        if (scoreValue && !scoreValue.textContent) {
            scoreValue.textContent = '0';
        }
        if (scoreLabel && !scoreLabel.textContent) {
            scoreLabel.textContent = 'Score';
        }
    }

    // Function to get selected goals and update modal
    function getSelectedGoalsAndUpdateModal() {
        const selectedGoals = [];
        document.querySelectorAll('.goal-checkbox:checked').forEach(checkbox => {
            selectedGoals.push(checkbox.value);
        });
        updateGoalsModal(selectedGoals);
        return selectedGoals;
    }

    // Function to show goals modal with populated goals
    function showGoalsTransitionModal() {
        // Ensure goals are populated in the modal
        setTimeout(() => {
            getSelectedGoalsAndUpdateModal();
        }, 100);
        
        document.getElementById('goalsTransitionModal').classList.add('show');
    }

    // Backup function for submitGoals (if called from external JS)
    function submitGoals() {
        showGoalsTransitionModal();
    }

    // Completion screen functions (if not already defined globally)
    if (typeof selectOffer === 'undefined') {
        window.selectOffer = function(offerType, element) {
            // Remove selected class from all offers
            document.querySelectorAll('.offer-option').forEach(opt => opt.classList.remove('selected'));
            
            // Add selected class to clicked offer
            element.classList.add('selected');
            
            // Enable continue button
            const continueBtn = document.getElementById('completionChoiceBtn');
            if (continueBtn) {
                continueBtn.disabled = false;
                continueBtn.style.opacity = '1';
            }
            
            // Store selected offer
            window.selectedCompletionOffer = offerType;
        };
    }

    if (typeof handleCompletionChoice === 'undefined') {
        window.handleCompletionChoice = function() {
            const selectedOffer = window.selectedCompletionOffer;
            
            if (selectedOffer === 'talk_team') {
                // Show date/time selection modal
                document.getElementById('dateTimeModal').classList.add('show');
            } else if (selectedOffer === 'self_explore') {
                // Show reason modal
                document.getElementById('reasonModal').classList.add('show');
            }
        };
    }

    // Handle time slot selection
    function selectTimeSlot(element, slotId) {
        // Remove selected class from all slots
        document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
        
        // Add selected class to clicked slot
        element.classList.add('selected');
        
        // Enable confirm button
        const confirmBtn = document.getElementById('confirmScheduleBtn');
        confirmBtn.disabled = false;
        confirmBtn.style.opacity = '1';
        
        // Store selected slot
        window.selectedTimeSlot = slotId;
    }

    // Confirm schedule
    function confirmSchedule() {
        const selectedSlot = window.selectedTimeSlot;
        if (selectedSlot) {
            alert(`Call scheduled! Our team will contact you at the selected time.`);
            closeModal('dateTimeModal');
        }
    }

    // Handle reason selection
    function selectReason(reasonType, element) {
        // Remove selected class from all reasons
        document.querySelectorAll('.reason-option').forEach(opt => opt.classList.remove('selected'));
        
        // Add selected class to clicked reason
        element.classList.add('selected');
        
        // Show/hide comment sections based on selection
        const lookingElseComments = document.getElementById('lookingElseComments');
        const reasonComments = document.getElementById('reasonComments');
        
        if (reasonType === 'looking_else') {
            lookingElseComments.style.display = 'block';
            reasonComments.style.display = 'none';
        } else {
            lookingElseComments.style.display = 'none';
            reasonComments.style.display = 'block';
        }
        
        // Enable submit button
        const submitBtn = document.getElementById('submitReasonBtn');
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
        
        // Store selected reason
        window.selectedReason = reasonType;
    }

    // Submit reason
    function submitReason() {
        const reasonType = window.selectedReason;
        let comment = '';
        
        if (reasonType === 'looking_else') {
            comment = document.getElementById('lookingElseText').value;
        } else {
            comment = document.getElementById('reasonText').value;
        }
        
        alert(`Thank you for your feedback! We'll use this to improve our service.`);
        closeModal('reasonModal');
    }

    // Update goals display in modal to show inline with line breaks
    function updateGoalsModal(selectedGoals) {
        const goalsInlineText = document.getElementById('selectedGoalsInlineText');
        if (goalsInlineText && selectedGoals && selectedGoals.length > 0) {
            const goalIcons = {
                'ecommerce': 'üõí Sell Online',
                'customers': 'üìà Reach More Customers', 
                'manage': 'üë• Manage Customers',
                'search': 'üîç Appear in Search Results',
                'brand': '‚≠ê Establish Brand'
            };
            
            // Create goals with line breaks
            const goalsText = selectedGoals.map(goal => goalIcons[goal] || goal).join('<br>');
            goalsInlineText.innerHTML = goalsText;
        }
    }

    // FOMO notification auto-show/hide functionality
    function initializeFOMONotifications() {
        const fomoNotification = document.getElementById('fomoNotification');
        if (!fomoNotification) return;

        // Show FOMO notification initially after 3 seconds
        setTimeout(() => {
            fomoNotification.style.transform = 'translateX(0)';
            
            // Hide after 5 seconds
            setTimeout(() => {
                fomoNotification.style.transform = 'translateX(-400px)';
                
                // Show again every 30 seconds
                setInterval(() => {
                    fomoNotification.style.transform = 'translateX(0)';
                    setTimeout(() => {
                        fomoNotification.style.transform = 'translateX(-400px)';
                    }, 5000);
                }, 30000);
                
            }, 5000);
        }, 3000);
    }

    // Initialize categories when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Load categories when categories screen is shown
        const originalShowScreen = window.TopikoUtils?.showScreen;
        if (originalShowScreen) {
            window.TopikoUtils.showScreen = function(screenId) {
                originalShowScreen.call(this, screenId);
                if (screenId === 'categories') {
                    setTimeout(() => loadCategories(), 100);
                }
            };
        }
        
        // Initialize lead score widget text
        updateLeadScoreWidget();
        
        // Initialize FOMO notifications
        initializeFOMONotifications();
    });
    </script>

    <!-- Additional CSS for fixes -->
    <style>
    /* Quick Filters Container Styling */
    .quick-filters-container {
        width: 100%;
        margin-bottom: 1rem;
    }

    .quick-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(107, 70, 193, 0.2);
    }

    .quick-filter {
        padding: 0.5rem 1rem;
        border: 2px solid rgba(107, 70, 193, 0.3);
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 600;
        color: #6b46c1;
        transition: all 0.3s ease;
    }

    .quick-filter:hover {
        background: rgba(107, 70, 193, 0.1);
        border-color: #6b46c1;
    }

    .quick-filter.active {
        background: #6b46c1;
        color: white;
        border-color: #6b46c1;
    }

    /* Completion Screen Offer Styling */
    .offer-option {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .offer-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .offer-option.selected {
        transform: scale(1.02);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
    }

    .offer-option.selected label {
        border-color: #f59e0b !important;
        background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%) !important;
    }

    /* Animation for completion screen */
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        60% {
            transform: translateY(-5px);
        }
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }
    </style>
</body>
</html>
